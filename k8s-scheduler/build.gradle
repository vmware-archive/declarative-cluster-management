/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'nu.studer.jooq' version '4.2'
    id "com.gorylenko.gradle-git-properties" version "2.2.2"
}


apply plugin: 'java'
apply plugin: 'nu.studer.jooq'
apply plugin: "application"

dependencies {
    implementation project(':dcm')
    implementation 'com.zaxxer:HikariCP:3.4.2'
    implementation 'io.fabric8:kubernetes-client:4.10.1'
    implementation 'io.fabric8:kubernetes-server-mock:4.10.1'
    implementation 'io.dropwizard.metrics:metrics-core:4.1.0-rc3'
    implementation 'commons-cli:commons-cli:1.4'
    implementation 'commons-io:commons-io:2.7'
    implementation 'com.h2database:h2:1.4.200'
    jooqRuntime 'org.jooq:jooq-meta-extensions:3.13.1'
}

gitProperties {
    gitPropertiesName = "git.properties"
}

jooq {
 generateSchemaSourceOnCompilation = true
 sample(sourceSets.main) {
  generator {
   database {
     name = "org.jooq.meta.extensions.ddl.DDLDatabase"
     properties {
        property {
         key = 'scripts'
         value = 'src/main/resources/scheduler_tables.sql'
       }
     }
   }
   target {
      packageName = 'org.dcm.k8s.generated'
      directory = 'build/generated-sources/jooq'
   }
  } 
 }
}

def test = tasks.named("test") {
    useJUnitPlatform {
        excludeTags "integration-test"
    }
}

def integrationTest = tasks.register("integrationTest2", Test) {
    useJUnitPlatform {
        includeTags "integration-test"
    }
    shouldRunAfter test
}


application {
    mainClass = 'org.dcm.Scheduler'
}

task(runBenchmark, dependsOn: 'classes', type: JavaExec) {
   main = 'org.dcm.EmulatedCluster'
   classpath = sourceSets.main.runtimeClasspath
}